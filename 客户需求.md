





10.3.103.156:9201





![](../../项目文档/BS/龙净整线/问题点收集/新增需求/上料下料客户需求.jpg)



1，第一点需求，我注释掉了那一行代码，如图

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/第一点.png)

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/第一点2.png)







2，第二点需求，我做了一个事件处理的操作，如图

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/第二点.png)

在出站job 调用MES方法的地方，当mes出站接口以及条码绑定接口调用失败  而给PLC回复35 之后立刻发布事件

代码如图

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/第二2.png)



3，物料上下料需求的 **分析**

 目前**前端**物料列表的数据 直接来自**内存缓存**，

并且每一次的 **上料，卸料**操作      ，都会将  **内存缓存**与**数据库的数据**（字典表） 保持**同步**

既然  物料的消耗状态 改为以MES的数据为准，那么是不是  可以**不用**再将数据同步 到数据库（因为这个MES更新物料的接口   可能会频繁的调用，见下文）



图中最后一个提到的需求，**定时刷新**

对于后端而言，可以用调度中心 控制 job的启动与暂停（在job中定时推送），也可以配置化这个job的定时时间

可是对于前端而言，我不确定能不能 按照客户的想法 定时刷新这个 前端的物料列表，就类似于后台PLC调式界面的实时更新列表

（如果太过麻烦，我可以和再客户沟通一下，这个需求点是客户新增直接发出来的，没有与我 事先说明，

个人理解，如果一定要做的话，那么这个定时时间的设定，根据12的PPM，那么一个料5秒，物料消耗应该也是5秒，所以这个定时时间起码大于等于5秒，5秒调用一次物料更新接口）

我测试了一下 调度中心的使用    如图代码

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/job点.png)

测试结果如图

![](../../项目文档/BS/龙净整线/问题点收集/解决方案/第三点2.png)





最后关于顶盖焊数据丢失的情况，

个人分析，可能原因：

1，倍福PLC硬件问题

2，ADS路由问题

3，出站job中，如果得到了PLC的触发信号，会有会有  数据信道读取  **出站数据区** 和 **出站字符区**  **失败**的情况





各位PLC的老板，新建一个这样的标签，

标签的数据类型： 上位机的 Short  ，   PLC 是 Int

 汇川的标签名： |var|Inovance-PLC.Application.PC.MesOutNgShutdownAlarm

倍福标签名：PC.MesOutNgShutdownAlarm

​		

动作：如果收到上位机发的1，那么PLC控制机台停机报警  

（注意上位机对于这个标签不做清除操作，目前上位机只会写1，如果在出站时MES判定了多个条码出站失败，那么上位机会连续多次在这个标签写1，所以需要PLC老板们注意，在异常解除之后，操作员点击复位时，PLC程序才清除这个1，避免数据混乱）



整个逻辑：在出站时，如果mes判定出站NG     ，且出站NG的电池数量  达到了一个上位机许可的最大数量（目前是1），那么上位机将会在这个标签发送信号（1），PLC收到1 之后，停机报警







不对，这个2 要单独处理，

如果出站返回的 是 -1 ，那么要控制数量

如果出站返回的是 2 ，那么直接就要发信号报警
