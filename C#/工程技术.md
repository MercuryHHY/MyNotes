





## 串口通信

**代码详情见注释**

这里给出关键点

Dispatcher.Invoke是一个用于在UI线程上执行操作的方法。它常用于在非UI线程中调用UI元素或修改UI元素的属性，以避免多线程访问UI元素带来的线程安全问题。

在WPF和Windows Forms应用程序中，UI元素通常只能在UI线程上进行访问和修改。如果尝试在非UI线程上直接访问或修改UI元素，将会抛出线程异常。这就是为什么需要使用Dispatcher.Invoke方法。

Dispatcher.Invoke接受一个委托作为参数，并在UI线程上同步执行该委托。通过调用Dispatcher.Invoke，可以确保在UI线程上执行的代码安全访问和修改UI元素。



有一个串口数据接收事件DataReceived

相当于单片机中的串口接收中断，一个意思



[MODBUS RTU/TCP协议及常用功能码详解_modbustcp_听风ツ的博客-CSDN博客](https://blog.csdn.net/qq_43254236/article/details/118152650?spm=1001.2014.3001.5502)

[MODBUS RTU/TCP通讯实例C#(附源码)_c# modbus 源码_听风ツ的博客-CSDN博客](https://blog.csdn.net/qq_43254236/article/details/118252161?spm=1001.2014.3001.5502)

### DTR的概念

在串口通信中，DTR代表数据终端就绪（Data Terminal Ready）。DTR是一种控制信号，用于表示数据终端设备（如计算机）准备好进行通信。当DTR信号为高电平（通常是+12V）时，表示设备准备好进行通信；当DTR信号为低电平（通常是0V）时，表示设备不准备进行通信。

DTR信号通常用于串口设备的握手协议中，可以与数据设备就绪（DSR，Data Set Ready）信号进行配对使用，以确保通信之前的互联设备都准备就绪。在一些串口应用中，DTR信号也可以用于其他用途，如控制外部设备的电源开关等。具体使用方法和含义可能根据具体的串口设备和应用程序而有所不同。

### CRC的概念

在串口通信中，CRC (Cyclic Redundancy Check) 是一种错误检测机制，用于验证通过串行数据传输的信息是否被正确接收。

CRC通常是通过在发送数据时计算一组固定长度的校验码，并将该校验码附加到数据中发送。接收端在接收数据后，重新计算校验码，并将计算得到的校验码与接收到的校验码进行比较。如果两个校验码匹配，说明数据在传输过程中没有发生错误；如果两个校验码不匹配，说明数据可能被修改或损坏，需要重新发送。

CRC校验可以检测一定数量的位错误，但不能纠正这些错误。它在串口通信中被广泛使用，因为它简单且效果较好。不同的CRC算法会使用不同的多项式和计算方法，常见的CRC标准包括CRC-16和CRC-32等。

使用CRC校验可以提高串口通信的可靠性，确保数据在传输过程中的完整性。



### Modbus RTU

Modbus RTU (Remote Terminal Unit) 是一种串行通信协议，常用于工业自动化系统中的数据传输和设备之间的通信。以下是Modbus RTU的协议格式：

1. 数据位：
   - 每个字符有8个数据位。

2. 停止位：
   - 通常使用1个停止位。

3. 奇偶校验位：
   - 可以选择无校验位、奇校验位或偶校验位。

4. 帧格式：
   - 每个Modbus RTU帧由多个字节组成。
   - 帧的起始是一个前导字符，通常是一个高电平的间隙。
   - 前导字符后接一个从设备地址（1个字节），用于识别通信的从设备。
   - 地址字节后是一个功能码（1个字节），用于指定从设备执行的操作类型。
   - 功能码后是数据域（可变长度），包含用于读取或写入的寄存器地址和相关的数据。
   - 数据域后是一个CRC校验（2个字节），用于检测数据传输的错误。

总体而言，Modbus RTU的协议格式是：前导字符 + 地址 + 功能码 + 数据域 + CRC校验。

需要注意的是，Modbus RTU协议还有其他细节，如数据字节顺序和错误处理等，这些细节在实现和配置Modbus RTU通信时需要考虑。



**详解**

当使用Modbus RTU协议进行串行通信时，数据是以二进制形式传输。以下是Modbus RTU的协议格式的详细解释：

1. 首部：
   - 前导字符：前导字符是一个连续的高电平信号，用于同步通信。它的长度至少为3.5个字符时间，通常是11个比特时间。

2. 设备地址：
   - 设备地址是一个8位字节，用于识别通信的从设备或从站。
   - Modbus RTU协议支持从设备地址范围为1至247，其中1至127为标准设备地址，128至247为用户自定义设备地址。

3. 功能码：
   - 功能码用于指定从设备要执行的操作类型。
   - Modbus RTU协议定义了一系列功能码，用于读取、写入和控制从设备的不同功能。
   - 功能码是一个8位字节。

4. 数据域：
   - 数据域包含从主站发送给从站或从站发送给主站的数据。
   - 数据域的长度可变，取决于功能码和操作类型。
   - 数据以16位字节对齐，即每个数据值占用2个字节。

5. CRC校验：
   - CRC校验用于检测数据传输过程中的错误。
   - 它是一个16位的循环冗余校验值，由CRC算法计算得出。
   - CRC校验在数据域和校验字段一起进行校验。

6. 尾部：
   - 尾部由CRC校验值后面的一个或多个低电平组成。

总的来说，Modbus RTU的协议格式如下所示：前导字符 + 设备地址 + 功能码 + 数据域 + CRC校验 + 尾部。
每个部分的长度和结构都根据具体的通信需求和协议规范而变化。在实际应用中，确保正确解析和构建Modbus RTU帧的各个字段非常重要。









## Webservice

### 应用场景

WebService在工业领域的应用非常广泛，可以用于以下详细的应用场景：

1. 实时监控与数据采集：工业领域通常需要采集大量的实时数据，例如温度、压力、湿度等。通过使用WebService，可以将传感器和设备的实时数据传输到中央服务器或云平台进行监控和分析。这使得工程师可以随时监测设备状态、检测异常情况，并采取及时的措施。

2. 远程设备管理与维护：许多工业设备需要定期维护和保养。WebService可以被用于远程设备管理，使得工程师可以通过网络远程监控和控制设备的状态，并进行故障诊断和维护操作。这样可以降低设备停机时间和维护成本。

3. 安全性监控与访问控制：在工业领域中，安全性监控和访问控制是非常重要的。WebService可以用于实现访问控制策略、身份验证和数据加密，确保只有经过授权的用户能够访问和操作工业系统。这对于保护敏感数据、防止未经授权的操作和提高系统安全性非常关键。

4. 供应链管理与物流跟踪：工业领域的供应链管理需要不同供应商、生产商和分销商之间的协同合作和信息共享。通过WebService，可以实现供应链各个节点之间的数据交换和集成，包括订单处理、库存管理、物流跟踪等。这样可以实现更高效的供应链管理和实时的物流控制。

5. 远程协作与合作：在工业项目中，可能涉及到不同地点的工程师和技术人员之间的远程协作和合作。WebService提供了一种便捷的方式，使得工程师可以通过网络共享项目信息、交流和同步工作进度，提高团队协作效率。

总的来说，WebService在工业领域具有广泛的应用，可以用于实时监控与数据采集、远程设备管理与维护、安全性监控与访问控制、供应链管理与物流跟踪以及远程协作与合作等多个方面。它提供了一种强大的技术手段，促进了工业系统的智能化、高效化和可靠性。





### GTP的回答

当使用C#编写WebService服务器代码时，可以使用面向对象编程（OOP）的思想来设计和组织代码。以下是一个简单的示例，演示了如何使用OOP的概念编写WebService服务器代码：

首先，创建一个名为`WebServiceServer`的类，用于处理WebService请求和提供相应的功能。这个类将继承自`System.Web.Services.WebService`，以便能够定义WebService的方法和行为。然后，在这个类中定义具体的功能方法。

```csharp
using System.Web.Services;

public class WebServiceServer : System.Web.Services.WebService
{
    [WebMethod]
    public string GetHelloMessage()
    {
        return "Hello, World!";
    }

    [WebMethod]
    public int AddNumbers(int num1, int num2)
    {
        return num1 + num2;
    }
}
```

上述示例中的`WebServiceServer`类定义了两个Web方法：`GetHelloMessage`和`AddNumbers`。`GetHelloMessage`方法返回一个Hello消息，而`AddNumbers`方法接收两个整数参数，并返回它们的和。

接下来，需要在项目中添加一个.asmx文件，用于发布WebService。在Visual Studio中，右键单击项目，选择"添加" -> "新建项" -> "Web服务（ASMX）"，然后命名为`WebServiceServer.asmx`。打开.asmx文件，并将它绑定到`WebServiceServer`类。

```csharp
<%@ WebService Language="C#" Class="WebServiceServer" %>
```

现在，运行项目并测试WebService。根据项目的URL，将.asmx文件的地址附加到服务器地址上，即可访问WebService的方法。例如，假设项目在本地IIS上运行，.asmx文件的URL为http://localhost/MyWebService/WebServiceServer.asmx，那么您可以通过浏览器访问以下URL来调用WebService的方法：

- http://localhost/MyWebService/WebServiceServer.asmx/GetHelloMessage：调用`GetHelloMessage`方法并返回结果。
- http://localhost/MyWebService/WebServiceServer.asmx/AddNumbers?num1=5&num2=3：调用`AddNumbers`方法并传递两个参数，返回它们的和。

以上示例演示了如何使用C#编写WebService服务器代码，并应用了面向对象编程的思想。在实际开发中，您可以根据具体需求和业务逻辑来设计和扩展自己的WebService服务器代码。





### 大致的使用说明

[C# 超详细的WebService创建、发布与调用（VS2019）_c# webservice_音尘啊的博客-CSDN博客](https://blog.csdn.net/asd497907957/article/details/120196222)



额外：：

。Net 7.0 的Webserver 调用

[C#调用wsdl方法_c#如何调用wsdl文件_easyboot的博客-CSDN博客](https://blog.csdn.net/easyboot/article/details/130972968)



### 常见问题及解决方法

 注意，我的服务器一旦**发布**成功之后， 那么服务器将会**直接挂载在本主机上运行**，独立于 VS的运行之外

此外，如果代码修改了功能想同步到主机运行的服务器，则需要重新发布

(注意！！！重新发布会出现403.12   的错误提示，下面最后给出了解决方法)

注意，下面的操作我默认IIS管理器已经下载好了

这里给出不完整的参考文档：：

[Internet Information Services(IIS)管理器基本设置及创建网站_蒙蒙小公举的博客-CSDN博客](https://blog.csdn.net/qq_44102678/article/details/104153901)

[VS2022 创建webservice服务_vs webservice_淡水瑜的博客-CSDN博客](https://blog.csdn.net/weixin_29431461/article/details/124615017)

互补对着看



大致流程如下



![企业微信截图_20230814141714](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814141714.png)





![企业微信截图_20230814141950](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814141950.png)





![企业微信截图_20230814141909](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814141909.png)

你可以加一些方法

VS工程代码如下

![企业微信截图_20230814142220](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814142220.png)





接下来发布，大致于博客上无差别

![企业微信截图_20230814142348](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814142348.png)

按博客流程走



进入IIS之后，直接点  游览



会出现下面情况

![企业微信截图_20230814143856](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814143856.png)



解决方法如下：

![企业微信截图_20230814144015](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814144015.png)



![企业微信截图_20230814144027](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814144027.png)



然后点击  重新启动

![企业微信截图_20230814143910](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814143910.png)







OK！！！ 问题解决

![企业微信截图_20230814144047](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814144047.png)





注意几个事项



![企业微信截图_20230814145303](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814145303.png)

![企业微信截图_20230814145315](D:\黄浒烨\TY--MD文件\C#\工程技术PIC\企业微信截图_20230814145315.png)











## Excel 的导入和导出



参考代码如下

[C#代码实现 Excel表格与Object互相转换，Excel表格导入数据库（.NET2.0 .NET4.0）_weixin_30251829的博客-CSDN博客](https://blog.csdn.net/weixin_30251829/article/details/94941675)



我自己做了轮子可用，没有局限了，非常OK











## 日志框架的使用

[wpf Log4net的配置和使用 - 大海的泡沫 - 博客园 (cnblogs.com)](https://www.cnblogs.com/likui-bookHouse/p/11052053.html)

[使用C#日志系统框架Log4Net_c# 日志系统_*Major*的博客-CSDN博客](https://blog.csdn.net/qq_41375318/article/details/131631861)



注意，如果直接在APP.config 中直接添加日志的配置信息

那么你想输出的文件路径  就只能给出绝对路径

因为你工程的输出目录默认是  bin/Debug  

如果不给绝对路径，那么将自动存贮在此默认路径下

除非改输出路径，但是不建议乱动

关于日志的配置，我代码中有详细注释



关于HTTP的请求，注意是否有API秘钥，URL是否有参数

根据参数的类型，我能想到最好的方式使用表单 Dictionary 通过 键值对 传参

一如代码







## SQLSugar

[.NET -- ORM框架 - SqlSugar_sqlsugarscope_哈丨吅的博客-CSDN博客](https://blog.csdn.net/a549742320/article/details/126384368)

