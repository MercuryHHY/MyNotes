# 网络通信的详细说明



关于网络通信的细节 ，之前就一直想弄明白



两台设备进行通信，其实就是两个程序之间的数据通信

表面上看，代码中 send 与 recive 直接就已经完成了数据通信，可底层是怎么实现的呢？？？

走一遍完整的流程

事实上，send发送的数据首先经过 TCP/IP协议栈（网络模型）经过图中的5步处理

1. 获取应用层的传输数据
2. 确定好传输层协议（TCP 还是 UDP）
3. 封装端口号，IP地址
4. 封装MAC地址
5. 确定对方与自己的设备是否处于网咯中

将数据送达至自己的**网卡**

然后通过网卡进行数据传输



此图特别注意的是：**网卡的MAC地址是唯一的**，世界上没有两个相同的MAC地址，IP地址或许有相同的

<img src="D:\黄浒烨\TY--MD文件\网络通信\PIC\通信示意图.png" alt="通信示意图" style="zoom:150%;" />





那么TCP/IP协议栈（或者说网络模型）到底是什么呢？？

网络模型有理想化7层的，有通用五层的，也有简单的4层的

下面是对五层模型的详说明

![五层模型](D:\黄浒烨\TY--MD文件\网络通信\PIC\五层模型.png)

其中第3点，图中是对于 收到数据的角度看的

如果从发数据的角度看，上层的实现，才能确保下层的执行





实体层

物理手段将设备连接起来，也就是说其实全世界的网络设备其实都是用网线连接起来的

（海底电缆其实也就是网线，用于远程的网络连接，桥接于各个国家的网络）

![实体层](D:\黄浒烨\TY--MD文件\网络通信\PIC\实体层.png)



实体层存在的一些问题，链接层给出了解决方法

（网卡到网卡的通信）



![链路层](D:\黄浒烨\TY--MD文件\网络通信\PIC\链路层.png)

链路层做的事情其实就是 以太网协议





![                                                                                                                                                                                           ](D:\黄浒烨\TY--MD文件\网络通信\PIC\链路层说明2.png)



![链路层说明3](D:\黄浒烨\TY--MD文件\网络通信\PIC\链路层说明3.png)



网楼层是设备到设备的通信

![网楼层说明1](D:\黄浒烨\TY--MD文件\网络通信\PIC\网楼层说明1.png)

链路层的问题  网络层给出了解决方案（3个协议）

特别注意，这个IP地址的格式

![IP地址格式](D:\黄浒烨\TY--MD文件\网络通信\PIC\IP地址格式.png)

A到E  一共5类，D， E一般不用

对应的位置区分  网络地址与主机地址

 IP协议确定通信双方是否处于同一局域网络

ARP寻址协议就通过IP协议，找到接受者的MAC地址

![网络层说明2](D:\黄浒烨\TY--MD文件\网络通信\PIC\网络层说明2.png)



![路由层说明1](D:\黄浒烨\TY--MD文件\网络通信\PIC\路由层说明1.png)

第二点的补充说明，如果不在同一个局域网，那么主机H1 将会数据转交给他自己的网关进行路由



特别注意

网关就是路由器的说法不完全正确。尽管在某些情况下网关和路由器可以用来描述同一个设备，但严格来说，**网关是连接两个不同网络的设备，用于转发数据包到目标网络**，而**路由器是一种专门用于在不同网络之间转发数据的设备**。换句话说，路由器是网络设备的一种类型，而网关是连接两个网络并负责转发数据的设备。在一些家庭网络中，路由器可能会同时扮演路由器和网关的角色。



网关理解为 桥，路由就是从H1到H2的网络路径上的最优解（它底层有自己的算法实现）





![传输层](D:\黄浒烨\TY--MD文件\网络通信\PIC\传输层.png)



![应用层](D:\黄浒烨\TY--MD文件\网络通信\PIC\应用层.png)





![网络通信总体流程](D:\黄浒烨\TY--MD文件\网络通信\PIC\网络通信总体流程.png)

不断加头部，接收方接收到以后，有不断的拆包解析，很清晰的逻辑





















